/* CRIACAO DO ESQUEMA */

DROP DATABASE db_ra169767;
CREATE DATABASE db_ra169767;
USE db_ra169767;

DROP TABLE IF EXISTS CARGO;

CREATE TABLE CARGO (
       COD_CARGO            varchar(10) NOT NULL,
       NOME                 varchar(30) NOT NULL,
       IND_SUPERIOR           char NOT NULL,
       CONSTRAINT PK_CARGO
              PRIMARY KEY (COD_CARGO)
);

DROP TABLE IF EXISTS FUNC;

CREATE TABLE FUNC (
       MATR                 varchar(10) NOT NULL,
       NOME                 varchar(60) NOT NULL,
       TELEFONE             varchar(12) NULL,
       SEXO                 char NOT NULL,
       DATA_NASC            date NOT NULL,
       DATA_ADMISSAO        date NOT NULL,
       COD_DEPTO            varchar(10) NOT NULL,
       COD_CARGO            varchar(10) NOT NULL,
       NUM_DEPEND           integer NOT NULL,
       SALARIO              numeric(8,2) NOT NULL,
       GRAU_ESC             integer NOT NULL,
       FORMACAO             varchar(50) NULL,
       DATA_PROMOCAO        DATE NULL,
       CONSTRAINT PK_FUNC
              PRIMARY KEY (MATR)
);


/* CARGA DA TABELA DE FUNCIONARIOS */

INSERT INTO FUNC VALUES ('1234','JOAO DA SILVA','2424-4545','M','1965-06-15','1990-01-02','D01','AS-III',3,3500.00,'7','BANCO DE DADOS','2004-12-22');
INSERT INTO FUNC VALUES ('2345','MARIA DA SILVA',NULL,'F','1980-08-21','1998-07-12','D01','AS-II',0,2600.00,'8','ENG DE SOFTWARE','2002-10-05');
INSERT INTO FUNC VALUES ('3456','LUIS ALBERTO','9292-1234','M','1984-08-21','2004-10-15','D02','AD-TR',1,1200,'5','DIREITO',NULL);
INSERT INTO FUNC VALUES ('4567','ARTUR RIBEIRO','2588-8888','M','1982-12-21','2004-10-02','D01','AS-I',0,1800,'5','INFORMATICA','2005-01-02');
INSERT INTO FUNC VALUES ('5678','RENATA CARVALHO','2534-4333','F','1975-05-18','1994-06-06','D02','AD-II',1,2300,'6','DIREITO','2001-10-03');
INSERT INTO FUNC VALUES ('6789','SANDRO MOREIRA',NULL,'M','1978-06-17','1999-08-06','D03','TT-II',2,1300,'4',NULL,NULL);
INSERT INTO FUNC VALUES ('7890','ANTONIO CARLOS','9876-2121','M','1981-11-15','2001-04-12','D03','TT-I',0,1100,'4',NULL,'2002-05-06');
INSERT INTO FUNC VALUES ('8901','MARCELO PEREIRA','8182-2425','M','1972-07-07','1995-12-06','D03','TT-III',2,1900,'5','ENG TELECOM','2000-02-11');
INSERT INTO FUNC VALUES ('9012','JORGE CABRAL','9182-2325','M','1972-03-11','1990-01-06','D03','TT-III',1,2200,'4',NULL,'2004-04-02');
INSERT INTO FUNC VALUES ('0123','JOSE ANTONIO',NULL,'M','1975-09-13','1994-10-08','D03','TT-II',0,1500,'4',NULL,'2002-04-20');
INSERT INTO FUNC VALUES ('1122','PABLO OLIVEIRA','2543-4567','M','1963-06-15','1992-01-02','D01','AS-I',3,2600.00,'5','ENG COMPUTACAO','2005-02-02');
INSERT INTO FUNC VALUES ('1223','ADRIANA FREITAS',NULL,'F','1982-08-21','1999-07-12','D01','AS-II',0,2600.00,'6','INFORMATICA',NULL);
INSERT INTO FUNC VALUES ('2233','SIMONE CARVALHO','8877-2234','F','1980-08-21','2005-03-10','D02','SEC',1,800,'4',NULL,NULL);
INSERT INTO FUNC VALUES ('2334','ALINE DIAS','2588-8870','F','1978-12-21','2001-03-02','D01','AS-I',0,1800,'5','ENG COMPUTACAO','2004-10-22');
INSERT INTO FUNC VALUES ('3344','SUZANA CAMPOS','2521-4533','F','1972-05-18','1992-06-06','D02','AD-II',1,2300,'6','DIREITO','2000-06-06');
INSERT INTO FUNC VALUES ('3445','RICARDO TEIXEIRA',NULL,'M','1980-06-17','1997-08-06','D03','TT-II',2,1300,'4',NULL,'2005-03-10');
INSERT INTO FUNC VALUES ('4455','CARLOS ALBERTO','9546-1221','M','1983-11-15','2004-12-12','D03','TT-TR',0,1000,'4',NULL,NULL);
INSERT INTO FUNC VALUES ('4556','LEONARDO BRAGA','8193-2865','M','1973-07-07','1998-12-06','D03','TT-III',2,1900,'5','ENG TELECOM','2002-05-25');
INSERT INTO FUNC VALUES ('5566','JORGE LUCIO','9191-2323','M','1971-03-11','1989-12-06','D03','TT-III',1,2400,'4',NULL,'2004-01-01');
INSERT INTO FUNC VALUES ('5667','MARIO MACHADO',NULL,'M','1977-09-13','1996-10-08','D04','AR-TR',0,1000,'5','DIREITO','2003-01-01');
INSERT INTO FUNC VALUES ('6677','AURELIO SILVA','2764-5545','M','1968-06-15','1982-01-02','D04','AR-III',3,3000.00,'6','PSICOLOGIA','2005-01-01');
INSERT INTO FUNC VALUES ('6778','JUAN ANTONIO',NULL,'M','1979-08-21','1995-07-12','D04','AR-II',0,2600.00,'4',NULL,'2003-11-01');
INSERT INTO FUNC VALUES ('7788','ALAN MIRANDA','8212-1255','M','1988-08-21','1999-10-15','D04','AR-TR',1,1000,'5','PEDAGOGIA',NULL);
INSERT INTO FUNC VALUES ('7889','CELINA ANDRADE','2136-8897','F','1985-12-21','2003-03-02','D04','AR-I',0,1500,'5','PSICOLOGIA',NULL);
INSERT INTO FUNC VALUES ('8899','JANE TAVAREZ','2555-4343','F','1973-05-18','1990-01-26','D05','AF-II',1,2200,'6','ECONOMIA','2000-05-05');
INSERT INTO FUNC VALUES ('8990','LUCAS ALVAREZ',NULL,'M','1977-06-17','1996-08-06','D05','AF-II',2,1400,'4','CIENCIAS CONTABEIS','2003-01-10');
INSERT INTO FUNC VALUES ('9900','ANTONIA MAIA','9142-2321','F','1984-11-15','2000-04-12','D05','AF-I',0,1100,'5','ECONOMIA',NULL);
INSERT INTO FUNC VALUES ('9001','RICARDO MARTINS','8100-1223','M','1975-07-07','1991-12-06','D05','AF-III',2,1700,'6','ECONOMIA','2005-05-01');
INSERT INTO FUNC VALUES ('0011','ALEX DIAS','9442-3326','M','1974-03-11','1986-12-06','D05','AF-III',1,2300,'6','CIENCIAS CONTABEIS','2004-11-01');
INSERT INTO FUNC VALUES ('0112','SANDRA PEREIRA',NULL,'F','1973-09-13','1995-12-08','D05','AF-II',0,1300,'6','ECONOMIA','2003-12-01');

/* CARGA DA TABELA DE CARGOS */

INSERT INTO CARGO VALUES ('AS-TR','ANALISTA DE SISTEMAS TRAINEE','N');
INSERT INTO CARGO VALUES ('AS-I','ANALISTA DE SISTEMAS I','N');
INSERT INTO CARGO VALUES ('AS-II','ANALISTA DE SISTEMAS II','S');
INSERT INTO CARGO VALUES ('AS-III','ANALISTA DE SISTEMAS III','S');
INSERT INTO CARGO VALUES ('AF-TR','ANALISTA FINANCEIRO TRAINEE','N');
INSERT INTO CARGO VALUES ('AF-I','ANALISTA FINANCEIRO I','N');
INSERT INTO CARGO VALUES ('AF-II','ANALISTA FINANCEIRO II','S');
INSERT INTO CARGO VALUES ('AF-III','ANALISTA FINANCEIRO III','S');
INSERT INTO CARGO VALUES ('TT-TR','TECNICO TELECOM TRAINEE','N');
INSERT INTO CARGO VALUES ('TT-I','TECNICO TELECOM I','N');
INSERT INTO CARGO VALUES ('TT-II','TECNICO DE TELECOM II','S');
INSERT INTO CARGO VALUES ('TT-III','TECNICO DE TELECOM III','S');
INSERT INTO CARGO VALUES ('AD-TR','ADVOGADO TRAINEE','N');
INSERT INTO CARGO VALUES ('AD-I','ADVOGADO I','S');
INSERT INTO CARGO VALUES ('AD-II','ADVOGADO II','S');
INSERT INTO CARGO VALUES ('AD-III','ADVOGADO III','S');
INSERT INTO CARGO VALUES ('AR-TR','ANALISTA DE RH TRAINEE','N');
INSERT INTO CARGO VALUES ('AR-I','ANALISTA DE RH I','N');
INSERT INTO CARGO VALUES ('AR-II','ANALISTA DE RH II','S');
INSERT INTO CARGO VALUES ('AR-III','ANALISTA DE RH III','S');
INSERT INTO CARGO VALUES ('SEC','SECRETARIA','N');
INSERT INTO CARGO VALUES ('AA-I','AUX ADMIN I','N');
INSERT INTO CARGO VALUES ('AA-II','AUX ADMIN II','N');
INSERT INTO CARGO VALUES ('AA-III','AUX ADMIN III','N');
INSERT INTO CARGO VALUES ('ADM-I','ADMINISTRADOR I','N');
INSERT INTO CARGO VALUES ('ADM-II','ADMINISTRADOR II','N');
INSERT INTO CARGO VALUES ('ADM-III','ADMINISTRADOR III','N');
INSERT INTO CARGO VALUES ('ET-I','ENG TELECOM I','N');
INSERT INTO CARGO VALUES ('ET-II','ENG TELECOM II','N');
INSERT INTO CARGO VALUES ('ET-III','ENG TELECOM III','N');

/*Consultas*/
/*10*/
SELECT
	MATR,
	NOME,
	DATA_ADMISSAO,
	CASE
		WHEN ADDDATE(DATA_ADMISSAO, INTERVAL 1 YEAR) >= CURDATE() THEN 0
		ELSE YEAR(CURDATE()) - YEAR(DATA_ADMISSAO)
	END AS ANOS,
	CASE
		WHEN YEAR(CURDATE()) = YEAR(DATA_ADMISSAO)
			AND DAY(CURDATE()) >= DAY(DATA_ADMISSAO) THEN
				MONTH(CURDATE()) - MONTH(DATA_ADMISSAO)

		WHEN YEAR(CURDATE()) = YEAR(DATA_ADMISSAO)
			AND DAY(CURDATE()) < DAY(DATA_ADMISSAO) THEN
				MONTH(CURDATE()) - MONTH(DATA_ADMISSAO) - 1
		
		ELSE
			12 - MONTH(DATA_ADMISSAO) + MONTH(CURDATE())
	END AS MESES,

	CASE
		WHEN DAY(CURDATE()) >= DAY(DATA_ADMISSAO) THEN
			DAY(CURDATE()) - DAY(DATA_ADMISSAO)
		ELSE
			DAY(LAST_DAY(CURDATE())) - DAY(DATA_ADMISSAO) + DAY(CURDATE())
	END AS DIAS

FROM FUNC
ORDER BY ANOS, MESES, DIAS;

/*11*/
SELECT CASE GRAU_ESC
		WHEN 1 THEN '1o. GRAU INCOMPLETO'
		WHEN 2 THEN '1o. GRAU COMPLETO'
		WHEN 3 THEN '2o GRAU INCOMPLETO'
		WHEN 4 THEN '2o GRAU COMPLETO'
		WHEN 5 THEN 'SUPERIOR INCOMPLETO'
		WHEN 6 THEN 'SUPERIOR COMPLETO'
		WHEN 7 THEN 'PÓS-GRADUAÇÃO'
		WHEN 8 THEN 'MESTRADO'
		WHEN 9 THEN 'DOUTORADO'
	END AS ESCOLARIDADE,
	COUNT(*) AS NUM_FUNC,
	MAX(NUM_DEPEND) AS MAX_DEPEND,
	MIN(NUM_DEPEND) AS MIN_DEPEND,
	ROUND(AVG(NUM_DEPEND),1) AS MEDIA_DEPEND
FROM FUNC
GROUP BY GRAU_ESC
ORDER BY GRAU_ESC;

/*12*/
SELECT COD_DEPTO,
	CASE GRAU_ESC
		WHEN 1 THEN '1o. GRAU INCOMPLETO'
		WHEN 2 THEN '1o. GRAU COMPLETO'
		WHEN 3 THEN '2o GRAU INCOMPLETO'
		WHEN 4 THEN '2o GRAU COMPLETO'
		WHEN 5 THEN 'SUPERIOR INCOMPLETO'
		WHEN 6 THEN 'SUPERIOR COMPLETO'
		WHEN 7 THEN 'PÓS-GRADUAÇÃO'
		WHEN 8 THEN 'MESTRADO'
		WHEN 9 THEN 'DOUTORADO'
	END AS ESCOLARIDADE,
	ROUND(AVG(SALARIO),2) AS SALARIO_MEDIO
FROM FUNC
WHERE COD_DEPTO IN (SELECT COD_DEPTO 
		FROM FUNC
		GROUP BY COD_DEPTO
		HAVING COUNT(*) >= 5)
GROUP BY COD_DEPTO, GRAU_ESC
ORDER BY COD_DEPTO;

/*13*/
SELECT COD_DEPTO, SALARIO, MATR,
	MAX(SALARIO) AS MAX_SAL,
	MIN(SALARIO) AS MIN_SAL,
	COUNT(*) AS QTD_FUNC_DEPTO
FROM FUNC
GROUP BY COD_DEPTO
HAVING (COUNT(*) >= 5) AND (MAX_SAL >= 2*MIN_SAL)
ORDER BY COD_DEPTO;

/*14--------------------------------------------------------*/
/*SELECT DATA_ADMISSAO
	MONTH(DATA_ADMISSAO)
	YEAR(DATA_ADMISSAO),
	COUNT() AS QTD_CONTR_MES,
	COUNT() AS QTD_CONTR_ANO,
FROM FUNC
WHERE (QTD_CONTR_MES >= 2)
GROUP BY MES, ANO
ORDER BY MES, ANO*/

/*15*/
SELECT MATR, NOME, GRAU_ESC
FROM FUNC
WHERE GRAU_ESC > (SELECT AVG(GRAU_ESC) FROM FUNC);


/*16---------------------------*/
/*SELECT COD_DEPTO

	AVG(SALARIO)
WHERE*/

/*17--------------------------*/
/*SELECT MATR, NOME, DATA_NASC, DATA_ADMISSAO
FROM FUNC
WHERE DATA_ADMISSAO < DATA_NASC*/

/*18*/	
SELECT COD_CARGO,
	COUNT(*) AS NUM_FUNC
FROM FUNC
GROUP BY COD_CARGO
ORDER BY NUM_FUNC;